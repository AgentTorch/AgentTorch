
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../configure-behavior/">
      
      
        <link rel="next" href="../integrating-with-beckn/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>Gradient-based Calibration - AgentTorch</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#calibrating-an-agenttorch-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AgentTorch" class="md-header__button md-logo" aria-label="AgentTorch" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AgentTorch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gradient-based Calibration
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AgentTorch" class="md-nav__button md-logo" aria-label="AgentTorch" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AgentTorch
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Framework Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../creating-a-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Creating a Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using the Config API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../processing-a-population/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Customizing the Population
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configure-behavior/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prompting LLM as LPM agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Gradient-based Calibration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Gradient-based Calibration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helper-classes-and-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Classes and Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-1-internal-parameter-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Method 1: Internal Parameter Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 1: Internal Parameter Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-this-method" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this method?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-2-external-parameter-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Method 2: External Parameter Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 2: External Parameter Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-this-method_1" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this method?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-3-generator-based-parameter-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Method 3: Generator-Based Parameter Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 3: Generator-Based Parameter Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-this-method_2" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this method?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Putting It All Together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrating-with-beckn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    From Simulation to Reality
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../creating-archetypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benchmark: Modeling with Archetypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compare-llm-performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benchmark: Sensitivity to Agent Behaviors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../differentiable-discrete-sampling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Differentiable Discrete Sampling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helper-classes-and-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Classes and Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-1-internal-parameter-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Method 1: Internal Parameter Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 1: Internal Parameter Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-this-method" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this method?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-2-external-parameter-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Method 2: External Parameter Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 2: External Parameter Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-this-method_1" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this method?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-3-generator-based-parameter-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Method 3: Generator-Based Parameter Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Method 3: Generator-Based Parameter Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-this-method_2" class="md-nav__link">
    <span class="md-ellipsis">
      When to use this method?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Putting It All Together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="calibrating-an-agenttorch-model">Calibrating an AgentTorch Model</h1>
<p>This tutorial demonstrates how to calibrate parameters in an AgentTorch model using different optimization approaches. We'll explore three methods for parameter optimization and discuss when to use each approach.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Basic understanding of PyTorch and gradient-based optimization</li>
<li>Familiarity with AgentTorch's basic concepts</li>
<li>Python 3.8+</li>
<li>Required packages listed in <code>requirements.txt</code></li>
</ul>
<h2 id="installation">Installation</h2>
<pre><code class="language-bash">pip install -r requirements.txt
</code></pre>
<h2 id="overview">Overview</h2>
<p>Model calibration is a crucial step in agent-based modeling. AgentTorch provides several approaches to optimize model parameters:</p>
<ol>
<li>Internal parameter optimization</li>
<li>External parameter optimization</li>
<li>Generator-based parameter optimization</li>
</ol>
<h2 id="basic-setup">Basic Setup</h2>
<p>First, let's set up our environment and import the necessary modules:</p>
<pre><code class="language-python">import warnings
warnings.simplefilter(&quot;ignore&quot;)

import torch
import torch.nn as nn
from agent_torch.models import covid
from agent_torch.populations import sample
from agent_torch.core.executor import Executor
from agent_torch.core.dataloader import LoadPopulation

# Initialize simulation
sim = Executor(covid, pop_loader=LoadPopulation(sample))
runner = sim.runner
runner.init()
</code></pre>
<h2 id="helper-classes-and-functions">Helper Classes and Functions</h2>
<p>We'll define some helper components that we'll use throughout the tutorial:</p>
<pre><code class="language-python">class LearnableParams(nn.Module):
    &quot;&quot;&quot;A neural network module that generates bounded parameters&quot;&quot;&quot;
    def __init__(self, num_params, device='cpu'):
        super().__init__()
        self.device = device
        self.num_params = num_params
        self.learnable_params = nn.Parameter(torch.rand(num_params, device=self.device))
        self.min_values = torch.tensor(2.0, device=self.device)
        self.max_values = torch.tensor(3.5, device=self.device)
        self.sigmoid = nn.Sigmoid()

    def forward(self):
        out = self.learnable_params
        # Bound output between min_values and max_values
        out = self.min_values + (self.max_values - self.min_values) * self.sigmoid(out)
        return out

def execute(runner, n_steps=5):
    &quot;&quot;&quot;Execute simulation and compute loss&quot;&quot;&quot;
    runner.step(n_steps)
    labels = runner.state_trajectory[-1][-1]['environment']['daily_infected']
    return labels.sum()
</code></pre>
<h2 id="method-1-internal-parameter-optimization">Method 1: Internal Parameter Optimization</h2>
<p>The first approach optimizes parameters that are internal to the simulation. This is useful when you want to directly optimize parameters that are part of your model's structure.</p>
<pre><code class="language-python">def optimize_internal_params():
    # Execute simulation and compute gradients
    loss = execute(runner)
    loss.backward()

    # Get gradients of learnable parameters
    learn_params_grad = [(name, param, param.grad) 
                        for (name, param) in runner.named_parameters()]
    return learn_params_grad

# Example usage
gradients = optimize_internal_params()
print(&quot;Internal parameter gradients:&quot;, gradients)
</code></pre>
<h3 id="when-to-use-this-method">When to use this method?</h3>
<ul>
<li>When parameters are naturally part of your simulation structure</li>
<li>When you want direct control over parameter optimization</li>
<li>For simpler models with fewer parameters</li>
</ul>
<h2 id="method-2-external-parameter-optimization">Method 2: External Parameter Optimization</h2>
<p>The second approach involves optimizing external parameters that are fed into the simulation. This provides more flexibility in parameter management.</p>
<pre><code class="language-python">def optimize_external_params():
    # Create external parameters
    external_params = nn.Parameter(
        torch.tensor([2.7, 3.8, 4.6], requires_grad=True)[:, None]
    )

    # Set parameters in the runner
    learnable_params = runner.named_parameters()
    params_dict = {next(iter(learnable_params))[0]: external_params}
    runner._set_parameters(params_dict)

    # Execute and compute gradients
    loss = execute(runner)
    loss.backward()
    return external_params.grad

# Example usage
gradients = optimize_external_params()
print(&quot;External parameter gradients:&quot;, gradients)
</code></pre>
<h3 id="when-to-use-this-method_1">When to use this method?</h3>
<ul>
<li>When you want to manage parameters outside the simulation</li>
<li>For parameter sweeps or sensitivity analysis</li>
<li>When parameters need to be shared across different components</li>
</ul>
<h2 id="method-3-generator-based-parameter-optimization">Method 3: Generator-Based Parameter Optimization</h2>
<p>The third approach uses a generator function to predict optimal parameters. This is particularly useful for complex parameter relationships.</p>
<pre><code class="language-python">def optimize_with_generator():
    # Create generator model
    learn_model = LearnableParams(3)
    params = learn_model()[:, None]

    # Execute and compute gradients
    loss = execute(runner)
    loss.backward()

    # Get gradients of generator parameters
    learn_params_grad = [(param, param.grad) 
                        for (name, param) in learn_model.named_parameters()]
    return learn_params_grad

# Example usage
gradients = optimize_with_generator()
print(&quot;Generator parameter gradients:&quot;, gradients)
</code></pre>
<h3 id="when-to-use-this-method_2">When to use this method?</h3>
<ul>
<li>When parameters have complex relationships</li>
<li>For learning parameter patterns</li>
<li>When you want to generate parameters based on conditions</li>
</ul>
<h2 id="putting-it-all-together">Putting It All Together</h2>
<p>Here's how to use all three methods in a complete optimization loop:</p>
<pre><code class="language-python">def calibrate_model(method='internal', num_epochs=10):
    for epoch in range(num_epochs):
        if method == 'internal':
            gradients = optimize_internal_params()
        elif method == 'external':
            gradients = optimize_external_params()
        else:  # generator
            gradients = optimize_with_generator()

        print(f&quot;Epoch {epoch}, gradients: {gradients}&quot;)
        # Add your optimizer step here

# Example usage
calibrate_model(method='internal', num_epochs=3)
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Choose the Right Method</strong>: Consider your specific use case when selecting an optimization approach.</li>
<li><strong>Monitor Convergence</strong>: Always track your loss function to ensure proper optimization.</li>
<li><strong>Validate Results</strong>: Cross-validate your calibrated parameters with held-out data.</li>
<li><strong>Handle Constraints</strong>: Use appropriate bounds and constraints for your parameters.</li>
</ol>
<h2 id="common-pitfalls">Common Pitfalls</h2>
<ul>
<li>Ensure parameters have appropriate ranges</li>
<li>Watch out for local optima</li>
<li>Be careful with learning rates in optimization</li>
<li>Consider the computational cost of each approach</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>We've explored three different approaches to model calibration in AgentTorch. Each method has its strengths and is suited for different scenarios. Choose the approach that best matches your specific needs and model complexity.</p>
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://agent-torch.ai/">AgentTorch Documentation</a></li>
<li><a href="https://pytorch.org/docs/stable/optim.html">PyTorch Optimization</a></li>
<li><a href="../">Related Tutorials</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>